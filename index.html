<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚³ã‚³ãƒ•ã‚©ãƒªã‚¢ç”¨ ç«‹ã¡çµµã‚µã‚¤ã‚ºèª¿æ•´ãƒ„ãƒ¼ãƒ«</title>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9BXH8C74WT"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-9BXH8C74WT');
    </script>


    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-image: linear-gradient(0deg, transparent 21px, #a4c1d7 22px),linear-gradient(90deg,  transparent 21px, #a4c1d7 22px);
            background-color: #f1f5f7;
            background-size: 22px 22px;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(102, 188, 234, 0.15);
            padding: 30px;
        }

        h1 {
            font-size: 1.8em;
            color: #555;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .header-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .header-links a {
            color: #66bcea;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .header-links a:hover {
            color: #4a9fce;
            text-decoration: underline;
        }
        
        .description-toggle {
            background: #66bcea;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(102, 188, 234, 0.2);
        }
        
        .description-toggle:hover {
            background: #4a9fce;
            box-shadow: 0 4px 12px rgba(102, 188, 234, 0.3);
        }
        
        .description-toggle::after {
            content: 'â–¼';
        }
        
        .description-toggle.active::after {
            transform: rotate(180deg);
        }
        
        .description {
            background: #f8f9ff;
            border-left: 4px solid #66bcea;
            padding: 0;
            margin-bottom: 30px;
            border-radius: 8px;
            line-height: 1.8;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.25s ease-out, padding 0.25s ease-out;
        }
        
        .description.active {
            max-height: 1000px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .description h2 {
            color: #4a9fce;
            font-size: 18px;
            margin-bottom: 15px;
        }
        
        .description h3 {
            color: #555;
            font-size: 16px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .description p {
            color: #555;
            margin-bottom: 12px;
        }
        
        .description ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }
        
        .description li {
            color: #555;
            margin-bottom: 6px;
        }
        
        .description .example {
            background: white;
            padding: 12px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .description strong {
            color: #4a9fce;
            font-weight: 600;
        }
        
        .upload-area {
            border: 3.5px dashed #66bcea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            background: #eff8ff;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(102, 188, 234, 0.1);
        }
        
        .upload-area:hover {
            border-color: #00f2fe;
            background: #e5fdff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 188, 234, 0.2);
        }
        
        .upload-area.dragover {
            border-color: #4a9fce;
            background: #e8f4fd;
            transform: scale(1.01);
            box-shadow: 0 4px 12px rgba(102, 188, 234, 0.25);
        }
        
        #fileInput {
            display: none;
        }
        
        .upload-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .upload-hint {
            font-size: 14px;
            color: #999;
        }
        
        .options {
            background: #f1f3f5;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .option-group {
            margin-bottom: 15px;
        }
        
        .option-group label {
            display: flex;
            align-items: center;
            font-size: 16px;
            color: #555;
            cursor: pointer;
        }
        
        .option-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
            accent-color: #66bcea;
        }
        
        .quality-option {
            margin-left: 30px;
            margin-top: 10px;
        }
        
        .quality-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .quality-option select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .quality-option select:focus {
            outline: none;
            border-color: #66bcea;
        }
        
        .quality-slider-container {
            display: none;
            align-items: center;
            gap: 10px;
            margin-left: 30px;
            margin-top: 10px;
        }
        
        .quality-slider-container.active {
            display: flex;
        }
        
        input[type="range"] {
            width: 200px;
            cursor: pointer;
            accent-color: #66bcea;
        }
        
        .quality-value {
            font-weight: 600;
            color: #66bcea;
            min-width: 40px;
        }
        
        .preview-area {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            max-height: 600px;
            overflow-y: auto;
            padding: 10px;
            border-radius: 12px;
            background: #fafafa;
        }
        
        .preview-area.active {
            display: grid;
        }
        
        .preview-area::-webkit-scrollbar {
            width: 10px;
        }
        
        .preview-area::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        .preview-area::-webkit-scrollbar-thumb {
            background: #66bcea;
            border-radius: 10px;
        }
        
        .preview-area::-webkit-scrollbar-thumb:hover {
            background: #4a9fce;
        }
        
        .preview-item {
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 10px;
            background: white;
            position: relative;
            transition: all 0.3s;
            min-height: 180px; /* èª­ã¿è¾¼ã¿ä¸­ã«é«˜ã•ãŒæ½°ã‚Œãªã„ã‚ˆã†ã«ç¢ºä¿ */
            display: flex;
            flex-direction: column;
            justify-content: center; /* Loadingæ–‡å­—ã‚’ä¸­å¤®ã« */
        }
        
        .preview-item img {
            width: 100%;
            height: 150px;
            object-fit: contain;
            background: repeating-conic-gradient(#f0f0f0 0% 25%, white 0% 50%) 50% / 20px 20px;
            border-radius: 8px;
            flex-grow: 1; /* ç”»åƒãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ */
        }
        
        .preview-name {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .preview-item .btn-remove {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 4px;
            width: 24px;
            height: 24px;
            padding: 0;
            cursor: pointer;
            font-size: 20px;
            line-height: 24px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-item .btn-remove:hover {
            background: #7f8c8d;
            transform: scale(1.15);
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-process {
            background: #66bcea;
            color: white;
        }
        
        .btn-process:hover:not(:disabled) {
            background: #4a9fce;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 188, 234, 0.4);
        }
        
        .btn-download {
            background: #3498db;
            color: white;
        }
        
        .btn-download:hover:not(:disabled) {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }
        
        .btn-clear {
            background: #95a5a6;
            color: white;
        }
        
        .btn-clear:hover:not(:disabled) {
            background: #7f8c8d;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(149, 165, 166, 0.4);
        }
        
        button:disabled {
            background: #ddd;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .status {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            border-radius: 12px;
            font-size: 14px;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.info {
            background: #e8f4fd;
            color: #0c5460;
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            font-size: 14px;
            color: #666;
        }
        
        .footer-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .footer-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #66bcea;
        }
        
        .footer a {
            color: #66bcea;
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer a:hover {
            color: #4a9fce;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ ã‚³ã‚³ãƒ•ã‚©ãƒªã‚¢ç”¨ ç«‹ã¡çµµã‚µã‚¤ã‚ºèª¿æ•´ãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="header-links">
            <a href="#" id="changelogLink" style="display: none;">ğŸ“ æ›´æ–°å±¥æ­´</a>
        </div>
        
        <button class="description-toggle" id="descriptionToggle">
            ğŸ“– ä½¿ã„æ–¹ãƒ»ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¤ã„ã¦ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§é–‹é–‰ï¼‰
        </button>
        
        <div class="description" id="description">
            <h2>âœ¨ã“ã®ãƒ„ãƒ¼ãƒ«ã§ã§ãã‚‹ã“ã¨</h2>
            <p>ã‚³ã‚³ãƒ•ã‚©ãƒªã‚¢ã§ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç«‹ã¡çµµã‚’åˆ‡ã‚Šæ›¿ãˆãŸã¨ãã€<strong>ã‚³ãƒã®ç”»åƒãŒæ€¥ã«å¤§ãããªã£ãŸã‚Šå°ã•ããªã£ãŸã‚Šã™ã‚‹å•é¡Œ</strong>ã‚’è§£æ±ºã—ã¾ã™ã€‚<br>
                ãªãŠã€ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚ãªãŸã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å‡¦ç†ã•ã‚Œã€ã‚µãƒ¼ãƒãƒ¼ã«ã¯é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</p>
            
            <h3>â—†ãªãœã‚µã‚¤ã‚ºãŒå¤‰ã‚ã£ã¦ã—ã¾ã†ã®ã‹</h3>
            <p>ã‚³ã‚³ãƒ•ã‚©ãƒªã‚¢ã§ã¯ã€ç”»åƒã®<strong>æ¨ªå¹…</strong>ã§ã‚³ãƒã®ç”»åƒã‚µã‚¤ã‚ºãŒæ±ºã¾ã‚Šã¾ã™</p>
            <div class="example">
                ä¾‹ãˆã°ï¼š<br>
                â€¢ é€šå¸¸ç«‹ã¡çµµï¼šæ¨ªå¹…500px â†’ ã‚³ãƒã®ç”»åƒã‚µã‚¤ã‚ºæ™®é€š<br>
                â€¢ æˆ¦é—˜ç«‹ã¡çµµï¼ˆæ­¦å™¨ã‚’æŒã£ã¦ã„ã‚‹ï¼‰ï¼šæ¨ªå¹…700px â†’ é€šå¸¸ç«‹ã¡çµµã«åˆã‚ã›ã¦ç¸®å°ã•ã‚Œã‚‹ãŸã‚ã€ã‚³ãƒç”»åƒãŒå°ã•ããªã‚‹<br>
                â€¢ å­ä¾›å·®åˆ†ï¼šæ¨ªå¹…300px â†’ é€šå¸¸ç«‹ã¡çµµã«åˆã‚ã›ã¦æ‹¡å¤§ã•ã‚Œã‚‹ãŸã‚ã€ã‚³ãƒç”»åƒãŒå¤§ãããªã‚‹
            </div>
            <p>åŒã˜ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã§ã‚‚ã€ãƒãƒ¼ã‚ºã‚„å·®åˆ†ã«ã‚ˆã£ã¦æ¨ªå¹…ãŒé•ã†ã¨ç«‹ã¡çµµã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ãŸã³ã«ã‚³ãƒã®ç”»åƒã®å¤§ãã•ãŒå¤‰ã‚ã£ã¦ã—ã¾ã„ã¾ã™</p>
            
            <h3>â—†ä½¿ã„æ–¹</h3>
            <ul>
                <li><strong>ç”»åƒã‚’ã¾ã¨ã‚ã¦èª­ã¿è¾¼ã‚€</strong> - åŒã˜ã‚­ãƒ£ãƒ©ã®å·®åˆ†ç”»åƒï¼ˆé€šå¸¸ãƒ»æˆ¦é—˜ãƒ»å­ä¾›ãªã©ï¼‰ã‚’å…¨éƒ¨é¸æŠ</li>
                <li><strong>ã€Œç”»åƒã‚’å‡¦ç†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</strong> - é€æ˜ãªä½™ç™½ã‚’å‰Šé™¤ã—ã€ä¸€ç•ªæ¨ªå¹…ãŒå¤§ãã„ç”»åƒã«åˆã‚ã›ã¦çµ±ä¸€</li>
                <li><strong>ã€Œã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã§ä¿å­˜</strong> - å‡¦ç†æ¸ˆã¿ã®ç”»åƒã‚’ã¾ã¨ã‚ã¦ä¿å­˜</li>
            </ul>
            
            <p><strong>çµæœï¼š</strong>ã™ã¹ã¦ã®ç”»åƒã®æ¨ªå¹…ãŒçµ±ä¸€ã•ã‚Œã‚‹ã®ã§ã€ç«‹ã¡çµµã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚<strong>ã‚³ãƒã®ç”»åƒã®å¤§ãã•ãŒå¤‰ã‚ã‚‰ãšã€èº«é•·å·®ã‚„ãƒãƒ¼ã‚ºã‚’ãã®ã¾ã¾ç¶­æŒ</strong>ã§ãã¾ã™</p>
            
            <h3>â—†å‚™è€ƒ</h3>
            <ul>
                <li>å…ƒã‹ã‚‰<strong>åŒã˜ç¸®å°ºã§æã‹ã‚Œã¦ã„ã‚‹ç«‹ã¡çµµ</strong>ã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚ãã‚Œä»¥å¤–ï¼ˆä¾‹ãˆã°ï¼šå­ã©ã‚‚ã‚’å¤§ãã„ã‚­ãƒ£ãƒ³ãƒã‚¹ã§æãã€å¤§äººã‚’å°ã•ã„ã‚­ãƒ£ãƒ³ãƒã‚¹ã§æã„ã¦ã„ã‚‹å ´åˆï¼‰ã§ã¯ã€ç”»åƒã®æ¨ªå¹…ã ã‘ãã‚ãˆã¦ã‚‚å®Ÿéš›ã®ä½“æ ¼å·®ã¯ç‹‚ã£ã¦ã—ã¾ã„ã¾ã™</li>
                <li>ç”»åƒã®é€æ˜éƒ¨åˆ†ã®ãƒˆãƒªãƒŸãƒ³ã‚°ã‚‚ã‚ã‚ã›ã¦è¡Œã„ã¾ã™</li>
                <li>ç”»åƒã‚’ä¸€æšã ã‘å…¥ã‚Œã¦ã€å˜ã«<strong>é€æ˜éƒ¨åˆ†ã®ãƒˆãƒªãƒŸãƒ³ã‚°ï¼†ç”»åƒã®è»½é‡åŒ–</strong>ã«ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™</li>
            </ul>
        </div>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-text">ğŸ“ ã‚¯ãƒªãƒƒã‚¯ã¾ãŸã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ç”»åƒã‚’é¸æŠ</div>
            <div class="upload-hint">PNG, WebPå½¢å¼ã«å¯¾å¿œï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</div>
            <input type="file" id="fileInput" accept=".png,.webp" multiple>
        </div>
        
        <div class="options">
            <div class="option-group">
                <label>
                    <input type="checkbox" id="convertWebP" checked>
                    WebPå½¢å¼ã«å¤‰æ›ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆPNGã‚ˆã‚Šãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’è»½é‡åŒ–ã§ãã¾ã™ï¼‰
                </label>
            </div>
            <div class="quality-option">
                <div class="quality-controls">
                    <label for="qualitySelect">å“è³ªè¨­å®šï¼š</label>
                    <select id="qualitySelect">
                        <option value="lossless" selected>Losslessï¼ˆç„¡åŠ£åŒ–ï¼‰</option>
                        <option value="slider">å“è³ªã‚’æŒ‡å®š</option>
                    </select>
                </div>
            </div>
            <div class="quality-slider-container" id="qualitySliderContainer">
                <input type="range" id="qualitySlider" min="50" max="100" value="90" step="1">
                <span class="quality-value" id="qualityValue">90%</span>
            </div>
        </div>
        
        <div class="preview-area" id="previewArea"></div>
        
        <div class="buttons">
            <button class="btn-process" id="processBtn" disabled>ç”»åƒã‚’å‡¦ç†</button>
            <button class="btn-download" id="downloadBtn" disabled>ã™ã¹ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
            <button class="btn-clear" id="clearBtn" disabled>ã‚¯ãƒªã‚¢</button>
        </div>
        
        <div id="status"></div>
        
        <div class="footer">
            <div class="footer-content">
                <span>ä½œæˆè€…: <a href="https://x.com/WW_3338" target="_blank" rel="noopener noreferrer">Wool&Wag</a></span>
                <!-- <img src="your-icon.png" alt="ä½œæˆè€…ã‚¢ã‚¤ã‚³ãƒ³" class="footer-icon"> -->
            </div>
        </div>
    </div>

    <script>
        let originalFiles = [];
        let processedImages = [];
        
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewArea = document.getElementById('previewArea');
        const processBtn = document.getElementById('processBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const clearBtn = document.getElementById('clearBtn');
        const convertWebPCheckbox = document.getElementById('convertWebP');
        const qualitySelect = document.getElementById('qualitySelect');
        const qualitySliderContainer = document.getElementById('qualitySliderContainer');
        const qualitySlider = document.getElementById('qualitySlider');
        const qualityValue = document.getElementById('qualityValue');
        const statusDiv = document.getElementById('status');
        const descriptionToggle = document.getElementById('descriptionToggle');
        const description = document.getElementById('description');
        const changelogLink = document.getElementById('changelogLink');
        
        // æ›´æ–°å±¥æ­´ãƒªãƒ³ã‚¯ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæœªä½¿ç”¨ï¼‰
        changelogLink.addEventListener('click', (e) => {
            e.preventDefault();
            alert('æ›´æ–°å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“');
            // å°†æ¥çš„ã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚„ãƒšãƒ¼ã‚¸é·ç§»ãªã©ã§æ›´æ–°å±¥æ­´ã‚’è¡¨ç¤ºã™ã‚‹ã‹ã‚‚
        });
        
        // èª¬æ˜ã®é–‹é–‰
        descriptionToggle.addEventListener('click', () => {
            descriptionToggle.classList.toggle('active');
            description.classList.toggle('active');
        });
        
        // å“è³ªè¨­å®šã®åˆ‡ã‚Šæ›¿ãˆ
        qualitySelect.addEventListener('change', () => {
            if (qualitySelect.value === 'slider') {
                qualitySliderContainer.classList.add('active');
            } else {
                qualitySliderContainer.classList.remove('active');
            }
        });
        
        // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®å€¤è¡¨ç¤ºã‚’æ›´æ–°
        qualitySlider.addEventListener('input', () => {
            qualityValue.textContent = qualitySlider.value + '%';
        });
        
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        
        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        // æ‹¡å¼µå­ã‚’é™¤ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—ã™ã‚‹é–¢æ•°
        function getFileNameBody(fileName) {
            return fileName.substring(0, fileName.lastIndexOf('.')) || fileName;
        }
        
        function handleFiles(files) {
            const newFiles = Array.from(files).filter(file => 
                file.type === 'image/png' || file.type === 'image/webp'
            );
            
            if (newFiles.length === 0) {
                showStatus('PNG ã¾ãŸã¯ WebP ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // ãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã«è¿½åŠ 
            originalFiles = [...originalFiles, ...newFiles];
            previewArea.classList.add('active');
            
            newFiles.forEach((file) => {
                const fileIndex = originalFiles.indexOf(file);
                
                // æ ã‚’ä½œæˆ
                const previewItem = document.createElement('div');
                previewItem.className = 'preview-item';
                previewItem.dataset.index = fileIndex;
                
                // èª­ã¿è¾¼ã¿ä¸­ã¯ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºã‚„ç©ºã®çŠ¶æ…‹ã«ã—ã¦ãŠã
                previewItem.innerHTML = `
                    <div class="loading">Loading...</div>
                `;
                
                // è¦ªè¦ç´ ã«è¿½åŠ ï¼ˆã“ã®æ™‚ç‚¹ã§é †ç•ªãŒç¢ºå®šã™ã‚‹ï¼‰
                previewArea.appendChild(previewItem);
                
                // ç”»åƒèª­ã¿è¾¼ã¿é–‹å§‹
                const reader = new FileReader();
                reader.onload = (e) => {
                    // èª­ã¿è¾¼ã¿å®Œäº†å¾Œã€äºˆç´„ã—ã¦ãŠã„ãŸæ ã®ä¸­èº«ã‚’æ›´æ–°ã™ã‚‹
                    previewItem.innerHTML = `
                        <button class="btn-remove" onclick="removeFile(${fileIndex})">Ã—</button>
                        <img src="${e.target.result}" alt="${file.name}">
                        <div class="preview-name" title="${file.name}">${file.name}</div>
                    `;
                };
                reader.readAsDataURL(file);
            });
            
            processBtn.disabled = false;
            clearBtn.disabled = false;
            downloadBtn.disabled = true;
            processedImages = [];
            showStatus(`${originalFiles.length} å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
        }
        
        function removeFile(index) {
            originalFiles.splice(index, 1);
            processedImages = [];
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å†æ§‹ç¯‰
            previewArea.innerHTML = '';
            if (originalFiles.length > 0) {
                originalFiles.forEach((file, i) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'preview-item';
                        previewItem.dataset.index = i;
                        previewItem.innerHTML = `
                            <button class="btn-remove" onclick="removeFile(${i})">Ã—</button>
                            <img src="${e.target.result}" alt="${file.name}">
                            <div class="preview-name" title="${file.name}">${file.name}</div>
                        `;
                        previewArea.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                });
                showStatus(`${originalFiles.length} å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`, 'success');
            } else {
                previewArea.classList.remove('active');
                processBtn.disabled = true;
                clearBtn.disabled = true;
                downloadBtn.disabled = true;
                statusDiv.textContent = '';
                statusDiv.className = 'status';
            }
        }
        
        processBtn.addEventListener('click', processImages);
        
async function processImages() {
            processBtn.disabled = true;
            showStatus('ç”»åƒã‚’å‡¦ç†ä¸­...', 'info');
            
            try {
                const imageDataList = [];
                const total = originalFiles.length;
                
                for (let i = 0; i < total; i++) {
                    const file = originalFiles[i];
                    showStatus(`ç”»åƒã‚’å‡¦ç†ä¸­... (${i + 1}/${total})`, 'info');
                    await new Promise(resolve => setTimeout(resolve, 0));

                    const img = await loadImage(file);
                    const trimmed = trimTransparentPixels(img);
                    imageDataList.push({
                        canvas: trimmed,
                        fileName: file.name
                    });
                }
                
                const maxWidth = Math.max(...imageDataList.map(data => data.canvas.width));
                
                processedImages = imageDataList.map(data => {
                    const padded = addHorizontalPadding(data.canvas, maxWidth);
                    return {
                        canvas: padded,
                        fileName: data.fileName
                    };
                });
                
                previewArea.innerHTML = '';
                
                processedImages.forEach((data, i) => {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'preview-item';
                    
                    // â˜…ä¿®æ­£ç‚¹: ã“ã“ã«ã€ŒÃ—ãƒœã‚¿ãƒ³ã€ã®HTMLã‚’è¿½åŠ ã—ã¾ã—ãŸ
                    // å‰Šé™¤æ™‚ã¯ removeFile(i) ã‚’å‘¼ã³å‡ºã—ã¾ã™ï¼ˆæœªå‡¦ç†çŠ¶æ…‹ã«æˆ»ã‚Šã¾ã™ï¼‰
                    previewItem.innerHTML = `
                        <button class="btn-remove" onclick="removeFile(${i})">Ã—</button>
                        <img src="${data.canvas.toDataURL()}" alt="${data.fileName}">
                        <div class="preview-name" title="${data.fileName}">${data.fileName} (å‡¦ç†æ¸ˆã¿)</div>
                    `;
                    previewArea.appendChild(previewItem);
                });
                
                downloadBtn.disabled = false;
                showStatus('å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');
            } catch (error) {
                console.error(error);
                showStatus('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message, 'error');
                processBtn.disabled = false;
            }
        }
        
        function loadImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function trimTransparentPixels(img) {
            const canvas = document.createElement('canvas');
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            let top = 0, bottom = canvas.height, left = 0, right = canvas.width;
            
            outer: for (let y = 0; y < canvas.height; y++) {
                for (let x = 0; x < canvas.width; x++) {
                    const alpha = data[(y * canvas.width + x) * 4 + 3];
                    if (alpha > 0) {
                        top = y;
                        break outer;
                    }
                }
            }
            
            outer: for (let y = canvas.height - 1; y >= 0; y--) {
                for (let x = 0; x < canvas.width; x++) {
                    const alpha = data[(y * canvas.width + x) * 4 + 3];
                    if (alpha > 0) {
                        bottom = y + 1;
                        break outer;
                    }
                }
            }
            
            outer: for (let x = 0; x < canvas.width; x++) {
                for (let y = 0; y < canvas.height; y++) {
                    const alpha = data[(y * canvas.width + x) * 4 + 3];
                    if (alpha > 0) {
                        left = x;
                        break outer;
                    }
                }
            }
            
            outer: for (let x = canvas.width - 1; x >= 0; x--) {
                for (let y = 0; y < canvas.height; y++) {
                    const alpha = data[(y * canvas.width + x) * 4 + 3];
                    if (alpha > 0) {
                        right = x + 1;
                        break outer;
                    }
                }
            }
            
            const trimmedWidth = right - left;
            const trimmedHeight = bottom - top;
            
            const trimmedCanvas = document.createElement('canvas');
            trimmedCanvas.width = trimmedWidth;
            trimmedCanvas.height = trimmedHeight;
            const trimmedCtx = trimmedCanvas.getContext('2d');
            
            trimmedCtx.drawImage(
                canvas,
                left, top, trimmedWidth, trimmedHeight,
                0, 0, trimmedWidth, trimmedHeight
            );
            
            return trimmedCanvas;
        }
        
        function addHorizontalPadding(canvas, targetWidth) {
            if (canvas.width >= targetWidth) {
                return canvas;
            }
            
            const paddedCanvas = document.createElement('canvas');
            paddedCanvas.width = targetWidth;
            paddedCanvas.height = canvas.height;
            const ctx = paddedCanvas.getContext('2d');
            
            const offsetX = Math.floor((targetWidth - canvas.width) / 2);
            ctx.drawImage(canvas, offsetX, 0);
            
            return paddedCanvas;
        }
        
        downloadBtn.addEventListener('click', downloadAllImages);
        async function downloadAllImages() {
            downloadBtn.disabled = true;
            showStatus('ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­... (ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã«ã”æ³¨æ„ãã ã•ã„)', 'info');
            
            const convertToWebP = convertWebPCheckbox.checked;
            const qualityMode = qualitySelect.value;
            let quality;
            
            if (qualityMode === 'lossless') {
                quality = 1.0;
            } else {
                quality = parseInt(qualitySlider.value) / 100;
            }
            
            for (let i = 0; i < processedImages.length; i++) {
                const data = processedImages[i];
                let fileName = data.fileName;
                let mimeType, downloadQuality;
                
                const nameBody = getFileNameBody(fileName);

                if (convertToWebP) {
                    fileName = `${nameBody}.webp`;
                    mimeType = 'image/webp';
                    downloadQuality = quality;
                } else {
                    // å…ƒãŒPNGãªã‚‰PNGã€ãã‚Œä»¥å¤–ã¯å…ƒã®æ‹¡å¼µå­ã‚’ç¶­æŒã¾ãŸã¯PNGã¸
                    if (fileName.toLowerCase().endsWith('.png')) {
                        mimeType = 'image/png';
                        fileName = `${nameBody}.png`;
                    } else {
                        // å…ƒãŒWebPã§å¤‰æ›ãªã—ã®å ´åˆãªã©
                        mimeType = 'image/webp'; 
                        fileName = `${nameBody}.webp`;
                    }
                    downloadQuality = 1.0; // PNGç­‰ã¯qualityæŒ‡å®šç„¡åŠ¹ã ãŒå¿µã®ãŸã‚
                }
                
                const blob = await new Promise(resolve => {
                    data.canvas.toBlob(resolve, mimeType, downloadQuality);
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                a.click();
                
                // ãƒ¡ãƒ¢ãƒªè§£æ”¾
                setTimeout(() => URL.revokeObjectURL(url), 1000);
                
                // ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯å›é¿ã®ãŸã‚å¾…æ©Ÿæ™‚é–“ã‚’é•·ã‚ã« (100ms -> 500msä»¥ä¸Šæ¨å¥¨)
                await new Promise(resolve => setTimeout(resolve, 500));
                
                // é€²æ—è¡¨ç¤º
                showStatus(`ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ä¸­... (${i + 1}/${processedImages.length})`, 'info');
            }
            
            downloadBtn.disabled = false;
            showStatus('ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼', 'success');
        }
        
        clearBtn.addEventListener('click', () => {
            originalFiles = [];
            processedImages = [];
            previewArea.innerHTML = '';
            previewArea.classList.remove('active');
            fileInput.value = '';
            processBtn.disabled = true;
            downloadBtn.disabled = true;
            clearBtn.disabled = true;
            statusDiv.textContent = '';
            statusDiv.className = 'status';
        });
        
        function showStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
        }
    </script>
</body>
</html>